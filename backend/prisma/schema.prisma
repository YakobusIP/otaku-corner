generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

enum ProgressStatus {
  PLANNED
  ON_HOLD
  ON_PROGRESS
  COMPLETED
  DROPPED
}

enum ErrorType {
  WARN
  ERROR
}

model Anime {
  id                    String         @id @default(uuid())
  malId                 Int            @unique
  type                  String
  status                String
  rating                String
  season                String?
  title                 String
  titleJapanese         String
  titleSynonyms         String
  source                String
  aired                 String
  broadcast             String
  episodesCount         Int?
  duration              String
  score                 Float?
  images                Json
  genres                AnimeGenres[]
  studios               AnimeStudios[]
  themes                AnimeThemes[]
  synopsis              String
  trailer               String?
  malUrl                String
  review                String?
  storylineRating       Int?
  qualityRating         Int?
  voiceActingRating     Int?
  soundTrackRating      Int?
  charDevelopmentRating Int?
  personalScore         Float?
  progressStatus        ProgressStatus @default(PLANNED)
  reviewImages          ReviewImage[]  @relation("AnimeReviewImages")
  episodes              AnimeEpisode[]
  consumedAt            DateTime?      @db.Date
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
}

model AnimeEpisode {
  id            String  @id @default(uuid())
  aired         String
  number        Int
  title         String
  titleJapanese String?
  titleRomaji   String?
  anime         Anime   @relation(fields: [animeId], references: [id], onDelete: Cascade)
  animeId       String
}

model Manga {
  id                    String         @id @default(uuid())
  malId                 Int            @unique
  status                String
  title                 String
  titleJapanese         String
  titleSynonyms         String
  published             String
  chaptersCount         Int?
  volumesCount          Int?
  score                 Float?
  images                Json
  authors               MangaAuthors[]
  genres                MangaGenres[]
  themes                MangaThemes[]
  synopsis              String
  malUrl                String
  review                String?
  storylineRating       Int?
  artStyleRating        Int?
  charDevelopmentRating Int?
  worldBuildingRating   Int?
  originalityRating     Int?
  personalScore         Float?
  progressStatus        ProgressStatus @default(PLANNED)
  reviewImages          ReviewImage[]  @relation("MangaReviewImages")
  consumedAt            DateTime?      @db.Date
  createdAt             DateTime       @default(now())
  updatedAt             DateTime       @updatedAt
}

model LightNovel {
  id                    String              @id @default(uuid())
  malId                 Int                 @unique
  status                String
  title                 String
  titleJapanese         String
  titleSynonyms         String
  published             String
  chaptersCount         Int?
  volumesCount          Int?
  score                 Float?
  images                Json
  authors               LightNovelAuthors[]
  genres                LightNovelGenres[]
  themes                LightNovelThemes[]
  synopsis              String
  malUrl                String
  review                String?
  storylineRating       Int?
  worldBuildingRating   Int?
  writingStyleRating    Int?
  charDevelopmentRating Int?
  originalityRating     Int?
  personalScore         Float?
  progressStatus        ProgressStatus      @default(PLANNED)
  reviewImages          ReviewImage[]       @relation("LightNovelReviewImages")
  consumedAt            DateTime?           @db.Date
  createdAt             DateTime            @default(now())
  updatedAt             DateTime            @updatedAt
}

model Genre {
  id          String             @id @default(uuid())
  name        String             @unique
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  animes      AnimeGenres[]
  mangas      MangaGenres[]
  lightNovels LightNovelGenres[]
}

model Studio {
  id        String         @id @default(uuid())
  name      String         @unique
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  animes    AnimeStudios[]
}

model Theme {
  id          String             @id @default(uuid())
  name        String             @unique
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  animes      AnimeThemes[]
  mangas      MangaThemes[]
  lightNovels LightNovelThemes[]
}

model Author {
  id          String              @id @default(uuid())
  name        String              @unique
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  mangas      MangaAuthors[]
  lightNovels LightNovelAuthors[]
}

model AnimeGenres {
  anime   Anime  @relation(fields: [animeId], references: [id])
  animeId String
  genre   Genre  @relation(fields: [genreId], references: [id])
  genreId String

  @@id([animeId, genreId])
}

model MangaGenres {
  manga   Manga  @relation(fields: [mangaId], references: [id])
  mangaId String
  genre   Genre  @relation(fields: [genreId], references: [id])
  genreId String

  @@id([mangaId, genreId])
}

model LightNovelGenres {
  lightNovel   LightNovel @relation(fields: [lightNovelId], references: [id])
  lightNovelId String
  genre        Genre      @relation(fields: [genreId], references: [id])
  genreId      String

  @@id([lightNovelId, genreId])
}

model AnimeStudios {
  anime    Anime  @relation(fields: [animeId], references: [id])
  animeId  String
  studio   Studio @relation(fields: [studioId], references: [id])
  studioId String

  @@id([animeId, studioId])
}

model AnimeThemes {
  anime   Anime  @relation(fields: [animeId], references: [id])
  animeId String
  theme   Theme  @relation(fields: [themeId], references: [id])
  themeId String

  @@id([animeId, themeId])
}

model MangaThemes {
  manga   Manga  @relation(fields: [mangaId], references: [id])
  mangaId String
  theme   Theme  @relation(fields: [themeId], references: [id])
  themeId String

  @@id([mangaId, themeId])
}

model LightNovelThemes {
  lightNovel   LightNovel @relation(fields: [lightNovelId], references: [id])
  lightNovelId String
  theme        Theme      @relation(fields: [themeId], references: [id])
  themeId      String

  @@id([lightNovelId, themeId])
}

model MangaAuthors {
  manga    Manga  @relation(fields: [mangaId], references: [id])
  mangaId  String
  author   Author @relation(fields: [authorId], references: [id])
  authorId String

  @@id([mangaId, authorId])
}

model LightNovelAuthors {
  lightNovel   LightNovel @relation(fields: [lightNovelId], references: [id])
  lightNovelId String
  author       Author     @relation(fields: [authorId], references: [id])
  authorId     String

  @@id([lightNovelId, authorId])
}

model AdminPin {
  id        String   @id @default(uuid())
  pin1      String
  pin2      String
  createdAt DateTime @default(now())
}

model ReviewImage {
  id        String   @id @default(uuid())
  url       String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  anime   Anime?  @relation("AnimeReviewImages", fields: [animeId], references: [id])
  animeId String?

  manga   Manga?  @relation("MangaReviewImages", fields: [mangaId], references: [id])
  mangaId String?

  lightNovel   LightNovel? @relation("LightNovelReviewImages", fields: [lightNovelId], references: [id])
  lightNovelId String?
}

model RequestLog {
  id        String   @id @default(uuid())
  hostname  String
  ip        String?
  method    String
  url       String
  headers   Json
  body      Json
  status    Int
  response  Json?
  timestamp DateTime @default(now())
}

model ErrorLog {
  id         String    @id @default(uuid())
  message    String
  type       ErrorType
  statusCode Int?
  stack      String?
  route      String
  timestamp  DateTime  @default(now())
}
